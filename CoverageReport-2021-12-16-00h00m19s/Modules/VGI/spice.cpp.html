<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
        <meta charset="utf-8"/>
	    <title>spice.cpp</title>
	    <link href="../../third-party/google-code-prettify/prettify-CppCoverage.css" type="text/css" rel="stylesheet" />
	    <script type="text/javascript" src="../../third-party/google-code-prettify/prettify.js"></script>
	</head>
    <body onload="prettyPrint()">
        <h4></h4>
        <pre class="prettyprint lang-cpp linenums">
#include &lt;glm/gtc/type_ptr.hpp&gt;
#include &lt;SpiceUsr.h&gt;
#include &lt;iostream&gt;

#include "glm/ext/vector_float3.hpp"
#include "spice.h"

namespace spice {

// The value comes from
// http://naif.jpl.nasa.gov/pub/naif/toolkit_docs/C/cspice/getmsg_c.html
// as the maximum message length
constexpr const unsigned SpiceErrorBufferSize = 1841;

<span style = "background-color:#dfd">void Init() {
    erract_c("SET", 0, const_cast&lt;char*&gt;("REPORT"));
    errprt_c("SET", 0, const_cast&lt;char*&gt;("NONE"));</span>

    // Load spice kernel for planetary data
<span style = "background-color:#dfd">    furnsh_c("assets/kernels/de440.bsp");</span>
    // furnsh_c("assets/kernels/jup365.bsp");
    // furnsh_c("assets/kernels/sat427l.bsp");
    // furnsh_c("assets/kernels/ura111.bsp");
<span style = "background-color:#dfd">    furnsh_c("assets/kernels/naif0012.tls");
}</span>

<span style = "background-color:#dfd">void LogError(std::string message) {</span>
    char buffer[SpiceErrorBufferSize];
<span style = "background-color:#dfd">    getmsg_c("LONG", SpiceErrorBufferSize, buffer);
    std::cout &lt;&lt; "[SPICE] " &lt;&lt; message &lt;&lt; " =&gt;&gt; " &lt;&lt; buffer &lt;&lt; std::endl;
    reset_c();
}</span>

<span style = "background-color:#dfd">glm::vec3 GetCoordinate(double ephemerisTime, std::string planet) {</span>
    double lt;
<span style = "background-color:#dfd">    glm::dvec3 position = glm::dvec3(0.0);</span>

<span style = "background-color:#dfd">    spkpos_c(planet.c_str(), ephemerisTime, "ECLIPJ2000",</span>
             "None", "Sun", glm::value_ptr(position), &amp;lt);

<span style = "background-color:#dfd">    if (failed_c()) {
        LogError("GetCoordinate");</span>
    }

<span style = "background-color:#dfd">    return glm::vec3(position[1], position[2], position[0]);
}</span>

<span style = "background-color:#dfd">double GetEphemerisTime(std::string date) {
    double ephemerisTime = 0.0;
    str2et_c(date.c_str(), &amp;ephemerisTime);
    if (failed_c()) {</span>
<span style = "background-color:#fdd">        LogError("GetEphemerisTime");</span>
    }
<span style = "background-color:#dfd">    return ephemerisTime;
}</span>

} // namespace spice</pre>
        <hr />
        <table width="100%">
            <thead>
                <tr>
                    <th align="center">
                        <small>Generated by</small>
                        <a href="https://github.com/OpenCppCoverage/OpenCppCoverage/releases">
                            <strong>OpenCppCoverage (Version: 0.9.9.0)</strong>
                        </a>
                    </th>
                </tr>
            </thead>
        </table>
    </body>
</html>