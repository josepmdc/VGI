<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
        <meta charset="utf-8"/>
	    <title>win32_thread.c</title>
	    <link href="../../third-party/google-code-prettify/prettify-CppCoverage.css" type="text/css" rel="stylesheet" />
	    <script type="text/javascript" src="../../third-party/google-code-prettify/prettify.js"></script>
	</head>
    <body onload="prettyPrint()">
        <h4></h4>
        <pre class="prettyprint lang-cpp linenums">
//========================================================================
// GLFW 3.4 Win32 - www.glfw.org
//------------------------------------------------------------------------
// Copyright (c) 2002-2006 Marcus Geelnard
// Copyright (c) 2006-2017 Camilla LÃ¶wy &lt;elmindreda@glfw.org&gt;
//
// This software is provided 'as-is', without any express or implied
// warranty. In no event will the authors be held liable for any damages
// arising from the use of this software.
//
// Permission is granted to anyone to use this software for any purpose,
// including commercial applications, and to alter it and redistribute it
// freely, subject to the following restrictions:
//
// 1. The origin of this software must not be misrepresented; you must not
//    claim that you wrote the original software. If you use this software
//    in a product, an acknowledgment in the product documentation would
//    be appreciated but is not required.
//
// 2. Altered source versions must be plainly marked as such, and must not
//    be misrepresented as being the original software.
//
// 3. This notice may not be removed or altered from any source
//    distribution.
//
//========================================================================
// Please use C89 style variable declarations in this file because VS 2010
//========================================================================

#include "internal.h"

#include &lt;assert.h&gt;


//////////////////////////////////////////////////////////////////////////
//////                       GLFW platform API                      //////
//////////////////////////////////////////////////////////////////////////

GLFWbool _glfwPlatformCreateTls(_GLFWtls* tls)
<span style = "background-color:#dfd">{
    assert(tls-&gt;win32.allocated == GLFW_FALSE);</span>

<span style = "background-color:#dfd">    tls-&gt;win32.index = TlsAlloc();
    if (tls-&gt;win32.index == TLS_OUT_OF_INDEXES)</span>
    {
<span style = "background-color:#fdd">        _glfwInputErrorWin32(GLFW_PLATFORM_ERROR,</span>
                             "Win32: Failed to allocate TLS index");
<span style = "background-color:#fdd">        return GLFW_FALSE;</span>
    }

<span style = "background-color:#dfd">    tls-&gt;win32.allocated = GLFW_TRUE;
    return GLFW_TRUE;
}</span>

void _glfwPlatformDestroyTls(_GLFWtls* tls)
<span style = "background-color:#dfd">{
    if (tls-&gt;win32.allocated)
        TlsFree(tls-&gt;win32.index);
    memset(tls, 0, sizeof(_GLFWtls));
}</span>

void* _glfwPlatformGetTls(_GLFWtls* tls)
<span style = "background-color:#dfd">{
    assert(tls-&gt;win32.allocated == GLFW_TRUE);
    return TlsGetValue(tls-&gt;win32.index);
}</span>

void _glfwPlatformSetTls(_GLFWtls* tls, void* value)
<span style = "background-color:#dfd">{
    assert(tls-&gt;win32.allocated == GLFW_TRUE);
    TlsSetValue(tls-&gt;win32.index, value);
}</span>

GLFWbool _glfwPlatformCreateMutex(_GLFWmutex* mutex)
<span style = "background-color:#dfd">{
    assert(mutex-&gt;win32.allocated == GLFW_FALSE);
    InitializeCriticalSection(&amp;mutex-&gt;win32.section);
    return mutex-&gt;win32.allocated = GLFW_TRUE;
}</span>

void _glfwPlatformDestroyMutex(_GLFWmutex* mutex)
<span style = "background-color:#dfd">{
    if (mutex-&gt;win32.allocated)
        DeleteCriticalSection(&amp;mutex-&gt;win32.section);
    memset(mutex, 0, sizeof(_GLFWmutex));
}</span>

void _glfwPlatformLockMutex(_GLFWmutex* mutex)
<span style = "background-color:#fdd">{
    assert(mutex-&gt;win32.allocated == GLFW_TRUE);
    EnterCriticalSection(&amp;mutex-&gt;win32.section);
}</span>

void _glfwPlatformUnlockMutex(_GLFWmutex* mutex)
<span style = "background-color:#fdd">{
    assert(mutex-&gt;win32.allocated == GLFW_TRUE);
    LeaveCriticalSection(&amp;mutex-&gt;win32.section);
}</span>
</pre>
        <hr />
        <table width="100%">
            <thead>
                <tr>
                    <th align="center">
                        <small>Generated by</small>
                        <a href="https://github.com/OpenCppCoverage/OpenCppCoverage/releases">
                            <strong>OpenCppCoverage (Version: 0.9.9.0)</strong>
                        </a>
                    </th>
                </tr>
            </thead>
        </table>
    </body>
</html>